<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ConwayBromageLib: ConwayBromageLib : an implementation of Conway and Bromage succinct data structure for assembling large genomes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ConwayBromageLib
   </div>
   <div id="projectbrief">Succinct data structure for assembling large genomes</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ConwayBromageLib : an implementation of Conway and Bromage succinct data structure for assembling large genomes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.com/yoann-dufresne/ConwayBromageLib"><img src="https://travis-ci.com/yoann-dufresne/ConwayBromageLib.svg?branch=master" alt="Build Status" style="pointer-events: none;" class="inline"/></a> </p>
<h1><a class="anchor" id="autotoc_md10"></a>
What is ConwayBromageLib ?</h1>
<p>The ConwayBromageLib (CBL) is a C++11 library that implements the succinct data structure described in the <a href="https://www.researchgate.net/publication/49765043_Succinct_Data_Structures_for_Assembling_Large_Genomes">article of Thomas C. Conway and Andrew J. Bromage</a>.<br  />
 CBL is developped for the assembling of larges genomes. It stores canonical k-mers and permits query operations. More specifically, it represents an edge-centric <b>De Bruijn Graph</b> in a memory-efficient way by also supporting time-efficient operations. </p>
<h1><a class="anchor" id="autotoc_md11"></a>
Method</h1>
<p>ConwayBromageLib is based on the <a href="https://github.com/simongog/sdsl-lite">SDSL</a> library which provides succinct data structures. More precisely, CBL use the class <code>sd_vector</code> which implements a sparse bit vector (vector made of zeros and ones) in order to store the k-mers. <br  />
 <br  />
 CBL takes a list of canonical k-mers as input. The bit vector use to store them has a size of 4^k. k-mers are represented by an index/position in the bit vector. If a specific position is set to one, it means that the k-mer representing this position is present at least once in the sequence. Otherwise (set to 0) it is absent.<br  />
 <br  />
 A succinct data structure is a data structure objects in memory-space close to the information-theoretic lower bounds and perform efficient query operations.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
What can I do with CBL ?</h1>
<p>CBL stores genomes sequences. Once it is done, we can apply two query operations : <br  />
 The query operation <b>contains</b> to know if a given (k-1)-mer is present or not.<br  />
 The query operation <b>successors</b> to get the successors of a (k-1)-mer.<br  />
 A successor of a k-mer <code>x</code> is any k-mer of the form <code>a+x[1:k-1]</code> or <code>x[2:k]+a</code> with <code>a</code> nucleotide.<br  />
 <b>Important</b> : elements of the query operations have always a size of (k-1) if we stored k-mers.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Requirements</h1>
<p>CBL requires :<br  />
 <code>g++</code> version 8.2.0 or higher.<br  />
 <code>cmake</code> version 3.12 or higher (to build unit tests).<br  />
 Mac OS and Linux (Ubuntu) are supported.<br  />
 K-mers that we want to store must be <b>canonical</b> and have a <b>size k &lt;= 32</b>. This means that we can query at most 31-mers.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Installation</h1>
<p>To download the library, use the following command : </p><div class="fragment"><div class="line">git clone --recurse-submodules https://github.com/yoann-dufresne/ConwayBromageLib.git</div>
</div><!-- fragment --><p>If you have already used <code>git clone</code> without the <code>--recurse-submodules</code> flag, please use in the project : </p><div class="fragment"><div class="line">git submodule init</div>
<div class="line">git submodule update</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15"></a>
How to use CBL ?</h1>
<p>To use CBL, please create a new C++ file.<br  />
 Example of code, main.cpp :<br  />
 </p><div class="fragment"><div class="line">#include &quot;ConwayBromageLib.h&quot;</div>
<div class="line"> </div>
<div class="line">using namespace std;</div>
<div class="line"> </div>
<div class="line">int main(){</div>
<div class="line">    ifstream f(&quot;my_demo_test.txt&quot;);     // file that contain k-mers</div>
<div class="line">    KmerManipulatorACGT k4(4);          // to encode k-mers in ACGT format</div>
<div class="line">    ConwayBromage cb(f, &amp;k4);           // build of the bit vector with 4-mers (the bit vector will be of size 4^k, here k = 4)</div>
<div class="line"> </div>
<div class="line">    KmerManipulatorACGT k3(3);          // to encode (k-1)-mers in ACGT format</div>
<div class="line">    uint64_t node = k3.encode(&quot;ACG&quot;);   // get the integer representing the (k-1)-mer</div>
<div class="line"> </div>
<div class="line">    cb.contains(node);                  // return true if the (k-1)-mer is present, otherwise returns false</div>
<div class="line">    cb.successors(node);                // return a uint8_t that represents carry information about the 8 potential successors </div>
<div class="line">                                        // (see documentation for more information)</div>
<div class="line"> </div>
<div class="line">    return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>To compile call the CBl <code>CMakeLists.txt</code> in your own project, for example with main.cpp above : </p><div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.16)</div>
<div class="line">project(test)</div>
<div class="line">add_compile_options(-Wall -Wextra)      #basic compiler options</div>
<div class="line">set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -std=c++11 -mavx2 -Dlest_FEATURE_AUTO_REGISTER=1 -Dlest_FEATURE_COLOURISE=1 -O3 -DNDEBUG&quot;) #Compilation flag</div>
<div class="line">set(SRCS</div>
<div class="line">        main.cpp)</div>
<div class="line">add_executable(test ${SRCS})</div>
<div class="line">add_subdirectory(ConwayBromageLib) #Where ConwayBromageLib contains CBl CMakeLists.txt </div>
<div class="line">target_link_libraries(finaltest cbl)    #the name of the CBl library is cbl</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md16"></a>
Bug reporting</h1>
<p>If there are bugs or mistakes in CBL please send us an issue on <a href="https://github.com/yoann-dufresne/ConwayBromageLib/issues">CBL issue reports</a> </p>
<h1><a class="anchor" id="autotoc_md17"></a>
External ressources</h1>
<p>CBL uses others libraries to work.<br  />
 The <a href="https://github.com/simongog/sdsl-lite">SDSL</a> that is a library implementing succinct data structures. We use it to implement bit vector (sd_vector in SDSL syntax).<br  />
 The <a href="https://github.com/martinmoene/lest#other-macros">Lest</a> library is used to write units tests. </p>
<h1><a class="anchor" id="autotoc_md18"></a>
Technical description for developers</h1>
<p>Below, you will find a description of the library's main functions. See the <a href="https://yoann-dufresne.github.io/ConwayBromageLib/">documentation</a> for further information. </p>
<h2><a class="anchor" id="autotoc_md19"></a>
The KmerManipulator class</h2>
<p>Abstract class that manage encoding (ACGT or ACTG) and size (the k) for k-mers<br  />
 Mother class of <a class="el" href="class_kmer_manipulator_a_c_g_t.html" title="KmerManipulator for ACGT encoding : permits to apply operations on k-mers in ACGT format.">KmerManipulatorACGT</a> and <a class="el" href="class_kmer_manipulator_a_c_t_g.html" title="KmerManipulator for ACTG encoding : permits to apply operations on k-mers in ACTG format.">KmerManipulatorACTG</a> </p>
<h2><a class="anchor" id="autotoc_md20"></a>
KmerManipulatorACGT::encode and KmerManipulatorACTG::encode</h2>
<p><b>encode</b> allow us to translate a k-mer into an <code>uint64_t</code> thanks to ACGT or ACTG encoding<br  />
 We use an hash to create and return unique <code>uint64_t</code>.<br  />
 The function takes a <code>string</code> (an uncompressed k-mer) and returns an <code>uint64_t</code> (a compressed k-mer) which corresponds to the given string sequence<br  />
 Example of use :<br  />
 </p><div class="fragment"><div class="line">KmerManipulatorACGT encoder(4); //4-mers in ACGT format</div>
<div class="line">encoder.encode(&quot;GGTA&quot;);     //172</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
KmerManipulatorACGT::decode and KmerManipulatorACTG::decode</h2>
<p><b>decode</b> does the opposite of <b>encode</b> : it takes an <code>uint64_t</code> and returns the corresponding k-mer string. Returns the string representation of a value representing a k-mer.<br  />
 Example of use : </p><div class="fragment"><div class="line">KmerManipulatorACTG decoder(4); //4-mers in ACTG format</div>
<div class="line">decoder.decode(248);    //GGTA</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
KmerManipulatorACGT::getCanonical and KmerManipulatorACTG::getCanonical</h2>
<p><b>getCanonical</b> takes an <code>uint64_t</code> (a compressed k-mer) and returns its canonical version in the form of an <code>uint64_t</code>.<br  />
 The canonical version depends on encoding format.<br  />
 Example of use : </p><div class="fragment"><div class="line">KmerManipulatorACGT canonicaler(4); //4-mers in ACGT format</div>
<div class="line">canonicaler.getCanonical(172);      //172</div>
<div class="line">KmerManipulatorACTG canonicaler(4); //4-mers in ACTG format</div>
<div class="line">canonicaler.getCanonical(172);      //144</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
ConwayBromage::ConwayBromage(istream&amp; kmerFlux, KmerManipulator* km)</h2>
<p>The <b><a class="el" href="class_conway_bromage.html" title="ConwayBromage : permits to store k-mers and apply two operations on them : &#39;contains&#39; and &#39;successors...">ConwayBromage</a> constructor</b> takes an istream which represents the k-mer flux and a <b><a class="el" href="class_kmer_manipulator.html" title="Abstract class : permits to apply operations on k-mers in two formats (see child classes)">KmerManipulator</a></b> which contains all the information about encoding format.<br  />
 It returns an object containing all the k-mers in the flux with very low memory consumption.<br  />
 Example of use : </p><div class="fragment"><div class="line">int kmerSize = 31;</div>
<div class="line">ifstream f(&quot;./k-mers.txt&quot;, ios::in);</div>
<div class="line">KmerManipulatorACGT km(kmerSize);</div>
<div class="line">ConwayBromage cb(f, &amp;km);        </div>
<div class="line">f.close();</div>
</div><!-- fragment --><p><b>Requirements</b></p><ul>
<li>The k-mers in the istream must me <b>canonical</b> and have a <b>size k &lt;= 32</b>.</li>
<li>The istream must have at each line (if it's a file for example) <b>a unique k-mers</b>.</li>
<li>The k-mers in the istream must be sorted either in lexicographical order (A&lt;C&lt;G&lt;T) or in A&lt;C&lt;T&lt;G. It depends on the encoding format. <div class="fragment"><div class="line">Example of a classic txt-file with k-mers of size 4 associated with the counts :</div>
<div class="line">AAAG    1 </div>
<div class="line">AAGA    3 </div>
<div class="line">AAGC    2 </div>
<div class="line">AAGC    1 </div>
</div><!-- fragment --></li>
</ul>
<p><br  />
</p>
<p><b>Note</b> : The presence of the counts doesn't affect building, they are automatically ignored by CBL.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
bool ConwayBromage::contains(uint64_t Kmer)</h2>
<p><b>contains</b> takes a (k-1)-mer (a <code>uint64_t</code>) and returns true if it's present among the stored k-mers.<br  />
 Example of use:<br  />
 </p><div class="fragment"><div class="line">bool kmer_exists = cb.contains(230);</div>
<div class="line"> </div>
<div class="line">KmerManipulatorACGT km(3);</div>
<div class="line">uint64_t intGTT = km.decode(&quot;GTT&quot;);</div>
<div class="line">bool GTT_exists = cb.contains(intGTT);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md25"></a>
uint8_t ConwayBromage::successors(uint64_t Kmer)</h2>
<p><b>successors</b> takes a (k-1)-mer (a <code>uint64_t</code>) and returns its potenial successors. A (k-1)-mer has at minimum 0 successors and maximum 8 successors.<br  />
 <b>Informations</b> : <br  />
</p><ul>
<li>The method doesn't check if the Kmer exists (so you have to do it on your own).</li>
</ul>
<p><b>Explanation on how it works</b> Let's say the function takes as a parameter the integer which represents the (k-1)-mer <b>GTT</b> and we assume we are in ACGT encoding.<br  />
 First, the method will generate the following k-mers : GTTA, GTTC, GTTG, GTTT, AGTT, CGTT, GGTT, TGTT.<br  />
 Then, it will check if the canonical version of these k-mers are present.<br  />
 Let's suppose that only the canonical version of these k-mers are present : GTTA, GTTT, CGTT, TGTT.<br  />
 GTTA and GTTT are, what we call <b>next</b> k-mers so we will store the information in the 4 left bits of the result (uint8_t).<br  />
 CGTT and TGTT are <b>previous</b> k-mers so, this time, the information will be stored in the 4 right bits of the result.<br  />
<br  />
 Thus, the function will return 1001 0101 which corresponds to 149 in base 10.<br  />
 It means that, in this example, <b>the successors of the (k-1)-mer GTT are TTA, TTT, CGT and TGT</b>.<br  />
</p>
<p>Example of use: <br  />
 </p><div class="fragment"><div class="line">uint8_t successors = cb.successors(78);</div>
<div class="line"> </div>
<div class="line">KmerManipulatorACGT km(3);</div>
<div class="line">uint64_t intGTT = km.decode(&quot;GTT&quot;);</div>
<div class="line">uint8_t successorsOfGTT = cb.successors(intGTT);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.19 </li>
  </ul>
</div>
</body>
</html>
